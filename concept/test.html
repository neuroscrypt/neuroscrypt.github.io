<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFmpeg.wasm –¢–µ—Å—Ç–æ–≤—ã–π –°—Ç–µ–Ω–¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .section-title {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select, button {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress-container {
            margin: 20px 0;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 20px;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .result-container {
            margin-top: 20px;
            display: none;
        }
        
        .video-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .video-box {
            background: #2c3e50;
            border-radius: 8px;
            padding: 10px;
        }
        
        .video-box h3 {
            color: white;
            text-align: center;
            margin-bottom: 10px;
        }
        
        video {
            width: 100%;
            border-radius: 5px;
            background: black;
        }
        
        .log-container {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            display: none;
        }
        
        .log-entry {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .log-info { color: #3498db; }
        .log-success { color: #2ecc71; }
        .log-warning { color: #f39c12; }
        .log-error { color: #e74c3c; }
        
        .download-link {
            display: inline-block;
            background: #2ecc71;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        
        .download-link:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: 600;
        }
        
        .status-loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-success {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 768px) {
            .video-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé• –¢–µ—Å—Ç–æ–≤—ã–π –°—Ç–µ–Ω–¥</h1>
            <p class="subtitle">–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
        </header>
        
        <div class="card">
            <h2 class="section-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <p>–≠—Ç–æ—Ç –¥–µ–º–æ-—Å—Ç–µ–Ω–¥, –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</p>
        </div>
        
        <div class="card">
            <h2 class="section-title">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ</h2>
            <div class="input-group">
                <label for="videoInput">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª:</label>
                <input type="file" id="videoInput" accept="video/*">
            </div>
            
            <div class="input-group">
                <label for="operation">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é:</label>
                <select id="operation">
                    <option value="convert">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ MP4</option>
                    <option value="extract_audio">–ò–∑–≤–ª–µ—á—å –∞—É–¥–∏–æ (MP3)</option>
                    <option value="gif">–°–æ–∑–¥–∞—Ç—å GIF</option>
                    <option value="trim">–û–±—Ä–µ–∑–∞—Ç—å –≤–∏–¥–µ–æ (–ø–µ—Ä–≤—ã–µ 10 —Å–µ–∫)</option>
                    <option value="resize">–ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä (720p)</option>
                </select>
            </div>
            
            <button id="processBtn" disabled>–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É</button>
            
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div id="statusMessage"></div>
        </div>
        
        <div class="video-container" id="videoContainer" style="display: none;">
            <div class="video-box">
                <h3>–ò—Å—Ö–æ–¥–Ω–æ–µ –≤–∏–¥–µ–æ</h3>
                <video id="originalVideo" controls></video>
            </div>
            <div class="video-box">
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏</h3>
                <video id="processedVideo" controls></video>
            </div>
        </div>
        
        <div class="result-container" id="resultContainer">
            <h2 class="section-title">–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
            <p>–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!</p>
            <a href="#" id="downloadLink" class="download-link">–°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</a>
        </div>
        
        <div class="log-container" id="logContainer">
            <h3>–õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
            <div id="logContent"></div>
        </div>
    </div>

    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.4/dist/umd/ffmpeg.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FFmpeg
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ 
            log: true,
            progress: ({ ratio }) => {
                const progress = Math.round(ratio * 100);
                updateProgress(progress);
                addLog(`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${progress}%`, 'info');
            }
        });
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const videoInput = document.getElementById('videoInput');
        const operationSelect = document.getElementById('operation');
        const processBtn = document.getElementById('processBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const originalVideo = document.getElementById('originalVideo');
        const processedVideo = document.getElementById('processedVideo');
        const videoContainer = document.getElementById('videoContainer');
        const resultContainer = document.getElementById('resultContainer');
        const downloadLink = document.getElementById('downloadLink');
        const logContainer = document.getElementById('logContainer');
        const logContent = document.getElementById('logContent');
        const statusMessage = document.getElementById('statusMessage');
        
        let loaded = false;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FFmpeg
        async function initFFmpeg() {
            if (loaded) return;
            
            showStatus('–ó–∞–≥—Ä—É–∑–∫–∞ FFmpeg.wasm... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.', 'loading');
            addLog('–ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ FFmpeg.wasm', 'info');
            
            try {
                await ffmpeg.load();
                loaded = true;
                showStatus('FFmpeg.wasm —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
                addLog('FFmpeg.wasm –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ FFmpeg.wasm: ' + error.message, 'error');
                addLog(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`, 'error');
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        videoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                originalVideo.src = url;
                videoContainer.style.display = 'grid';
                processBtn.disabled = !loaded;
                addLog(`–§–∞–π–ª –≤—ã–±—Ä–∞–Ω: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`, 'info');
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞
        processBtn.addEventListener('click', async function() {
            const file = videoInput.files[0];
            if (!file) {
                showStatus('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª', 'error');
                return;
            }
            
            if (!loaded) {
                showStatus('FFmpeg.wasm –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                return;
            }
            
            try {
                processBtn.disabled = true;
                progressContainer.style.display = 'block';
                logContainer.style.display = 'block';
                resultContainer.style.display = 'none';
                
                const operation = operationSelect.value;
                await processVideo(file, operation);
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∏–¥–µ–æ: ' + error.message, 'error');
                addLog(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: ${error.message}`, 'error');
            } finally {
                processBtn.disabled = false;
            }
        });
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ
        async function processVideo(file, operation) {
            addLog(`–ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏: ${operation}`, 'info');
            
            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ñ–∞–π–ª –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É FFmpeg
            const inputFileName = 'input.' + file.name.split('.').pop();
            ffmpeg.FS('writeFile', inputFileName, await fetchFile(file));
            
            let outputFileName, command;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
            switch (operation) {
                case 'convert':
                    outputFileName = 'output.mp4';
                    command = ['-i', inputFileName, '-c', 'copy', outputFileName];
                    break;
                case 'extract_audio':
                    outputFileName = 'output.mp3';
                    command = ['-i', inputFileName, '-q:a', '0', '-map', 'a', outputFileName];
                    break;
                case 'gif':
                    outputFileName = 'output.gif';
                    command = ['-i', inputFileName, '-t', '5', '-vf', 'fps=10,scale=320:-1', outputFileName];
                    break;
                case 'trim':
                    outputFileName = 'output.mp4';
                    command = ['-i', inputFileName, '-t', '10', '-c', 'copy', outputFileName];
                    break;
                case 'resize':
                    outputFileName = 'output.mp4';
                    command = ['-i', inputFileName, '-vf', 'scale=1280:720', '-c:a', 'copy', outputFileName];
                    break;
            }
            
            addLog(`–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã: ffmpeg ${command.join(' ')}`, 'info');
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É FFmpeg
            await ffmpeg.run(...command);
            
            // –ß–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const data = ffmpeg.FS('readFile', outputFileName);
            
            // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            const blob = new Blob([data.buffer], { 
                type: operation === 'extract_audio' ? 'audio/mpeg' : 'video/mp4'
            });
            const url = URL.createObjectURL(blob);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if (operation === 'extract_audio') {
                processedVideo.style.display = 'none';
                // –î–ª—è –∞—É–¥–∏–æ —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
                const audioElement = document.createElement('audio');
                audioElement.controls = true;
                audioElement.src = url;
                processedVideo.parentNode.appendChild(audioElement);
            } else {
                processedVideo.src = url;
                processedVideo.style.display = 'block';
            }
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            const extension = outputFileName.split('.').pop();
            downloadLink.href = url;
            downloadLink.download = `processed.${extension}`;
            downloadLink.textContent = `–°–∫–∞—á–∞—Ç—å ${extension.toUpperCase()}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            resultContainer.style.display = 'block';
            addLog(`–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${outputFileName}`, 'success');
            showStatus('–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function updateProgress(percent) {
            progressBar.style.width = `${percent}%`;
        }
        
        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContent.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status status-${type}`;
            statusMessage.style.display = 'block';
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º FFmpeg –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', initFFmpeg);
    </script>
</body>
</html>
